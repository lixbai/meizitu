function ManageNews(){window.tagArray=new Array}ManageNews.prototype.listenAddTag=function(){$(".add_tag_btn").click(function(){m_alert.alertOneInput({title:"请输入要添加的文章标签",placeholder:"文章标签",confirmCallback:function(a){var t=$.trim(a);m_ajax.post({url:"/cms/news_add_tags/",data:{tag:t},success:function(a){var t,e,n,o,r,s,l;200===a.code&&(t=a.data,console.log(t),e=t.id,n=t.tag,o=t.code,console.log(e),console.log(n),console.log(o),r=$(".add_cut_html"),s=$(".del_html"),l=$(".tags-list"),1===o?l.append("<li class='badge badge-success'><span class='SpanBtn' data-id="+e+" code-id="+o+">"+n+"</span>"+r.html()+"</li>"):l.append("<li class='badge badge-warning'><span class='SpanBtn' data-id="+e+" code-id="+o+">"+n+"</span>"+s.html()+"</li>"),tagArray.push(e),console.log(tagArray),m_alert.close())}})}})})},ManageNews.prototype.listenEditTag=function(){$(".tagBtn").on("click",".edit_tag_btn",function(){var r=$(this).parent().prev(),e=$.trim(r.text());m_alert.alertOneInput({title:"请输入新的标签",value:e,confirmCallback:function(a){var t=$.trim(a);t===e?m_alert.alertErrorToast("跟原来的值一样,不修改乱点什么!"):(m_ajax.post({url:"/cms/news_edit_tags/",data:{pk:r.attr("data-id"),tag:t},success:function(a){var t,e,n,o;200===a.code?(e=(t=a.data).id,n=t.tag,o=t.code,r.attr("data-id",e),r.attr("code-id",o),r.text(n),m_alert.close()):m_alert.alertErrorToast(a.message)}}),console.log(t))}})})},ManageNews.prototype.listenDelTag=function(){$(".tagBtn").on("click",".del_tag_btn",function(){var a=$(this),t=a.parent().prev(),e=a.parent().parent(),n=t.attr("data-id");console.log(n),1===t.attr("code-id")?m_ajax.post({url:"/cms/news_del_tags/",data:{pk:n},success:function(a){200===a.code&&(tagArray=$.grep(tagArray,function(a,t){return a!=n}),console.log(tagArray),e.remove())}}):(console.log(n),tagArray=$.grep(tagArray,function(a,t){return a!=n}),console.log(tagArray),e.remove())})},ManageNews.prototype.listenSubmitNews=function(){$("#submitBtn").click(function(){var t=[],a=$("#title").val();$("#category option:selected").each(function(){var a=$(this);t.push(parseInt(a.val()))});for(var e=$("#desc").val(),n=[],o=0;o<tagArray.length;o++){var r=tagArray[o];-1===$.inArray(r,n)&&n.push(r)}var s=$("#thumbnail").val();console.log(s),m_ajax.post({url:"/cms/ajax_news_post/",data:{title:a,desc:e,thumbnail:s,content:window.ue.getContent(),category_array:JSON.stringify(t),tag_array:JSON.stringify(n),dataType:"json"},success:function(a){200===a.code&&m_alert.alertSuccessToast("发布成功！",function(){window.location.reload()})}})})},ManageNews.prototype.run=function(){var a=this;a.listenAddTag(),a.listenEditTag(),a.listenDelTag(),a.listenSubmitNews()},$(function(){(new ManageNews).run()});